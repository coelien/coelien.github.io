---
title: 目标识别
tags: 计算机视觉
categories: [计算机视觉，传统方法，目标检测]
---
# 图像对齐&图像拼接

## 特征检测

 ### 边检测

#### 边

- 边是图像中的曲线，横跨边的两侧其亮度变化较大
- 分类：
  - 深度不连续（深度边）
  - 标准不连续（普通边）
  - 图层不连续（反射边）
  - 阴影边
- 可视化：通过强度函数和导数极值来理解

<img src="static\20211222103337.jpg" alt="20211222103337" style="zoom:50%;" />

#### 微分

- 微分具有线性性质和平移不变性：

  - 线性性质

  <img src="static\屏幕截图 2021-12-22 103703.jpg" alt="屏幕截图 2021-12-22 103703" style="zoom:50%;" />

  - 因此微分可以表示为卷积

- 对离散值图像进行微分
  - 重构出连续图像再计算导数
  - 直接取离散导数（有限差分）

<img src="static\屏幕截图 2021-12-22 104638.jpg" alt="屏幕截图 2021-12-22 104638" style="zoom:50%;" />

- 图像梯度

  - 对图像梯度的定义：

  <img src="static\屏幕截图 2021-12-22 105123.jpg" alt="屏幕截图 2021-12-22 105123" style="zoom:50%;" />

  - 边强度由梯度幅值给出：

  <img src="static\屏幕截图 2021-12-22 105320.jpg" alt="屏幕截图 2021-12-22 105320" style="zoom:50%;" />

  - 梯度方向为：



<img src="static\屏幕截图 2021-12-22 105450.jpg" alt="屏幕截图 2021-12-22 105450" style="zoom:50%;" />

- 使用scipy.signal.convolve2d来求图像梯度

  - 官方API文档：[链接](https://docs.scipy.org/doc/scipy/reference/generated/scipy.signal.convolve2d.html)

  - 代码及运行结果

    <img src="static\屏幕截图 2021-12-22 113110.jpg" alt="屏幕截图 2021-12-22 113110" style="zoom:50%;" />

#### 噪声

- 噪声对于求图像微分的影响很大

<img src="static\屏幕截图 2021-12-22 115407.jpg" alt="屏幕截图 2021-12-22 115407" style="zoom:50%;" />

- 使用平滑来解决噪声的影响
  - 加噪声可以参考[博客](https://www.cnblogs.com/wojianxin/p/12499928.html)
  - 平滑可以使用卷积来做

<img src="static\屏幕截图 2021-12-22 115613.jpg" alt="屏幕截图 2021-12-22 115613" style="zoom:50%;" />

#### 2D边检测过滤器

- 原理：

<img src="static\屏幕截图 2021-12-22 120910.jpg" alt="屏幕截图 2021-12-22 120910" style="zoom:50%;" />

- 高斯过滤器

<img src="static\屏幕截图 2021-12-22 120344.jpg" alt="屏幕截图 2021-12-22 120344" style="zoom:50%;" />

<img src="static\屏幕截图 2021-12-22 120519.jpg" alt="屏幕截图 2021-12-22 120519" style="zoom:50%;" />

- 各向异性高斯核

  - 应该沿边的方向进行平滑而不是在横跨边的方向上
  - 对于x-direction方向高斯核，在x的方向的标准差应较小，如下图所示：

  <img src="static\屏幕截图 2021-12-22 121545.jpg" alt="屏幕截图 2021-12-22 121545" style="zoom:50%;" />

  - 可以不只在x,y方向上进行微分，可以对滤波器进行旋转来得到各个方向上的微分

  ![屏幕截图 2021-12-22 121822](static\屏幕截图 2021-12-22 121822.jpg)

- 梯度幅度和方向

  - 如下图，分别为梯度的幅度和方向图：

  <img src="static\屏幕截图 2021-12-22 123022.jpg" alt="屏幕截图 2021-12-22 123022" style="zoom:50%;" />

  - 该图为另一例：

  <img src="static\屏幕截图 2021-12-22 123947.jpg" alt="屏幕截图 2021-12-22 123947" style="zoom:50%;" />

#### 边界和梯度幅值

- 设置梯度幅值的阈值来获得物体边界
  - 从小阈值到大阈值如图所示

<img src="static\屏幕截图 2021-12-22 135051.jpg" alt="屏幕截图 2021-12-22 135051" style="zoom: 33%;" />

- 使用最大化抑制（Non-maximum suppression ），只保留梯度幅值的局部峰值（local peaks），其他过滤掉，算法如下图所示：

<img src="static\屏幕截图 2021-12-22 135515.jpg" alt="屏幕截图 2021-12-22 135515" style="zoom:50%;" />

- 使用滞后阈值法来获取图像边界的一些实验结果图：

<img src="static\屏幕截图 2021-12-22 141914.jpg" alt="屏幕截图 2021-12-22 141914" style="zoom:50%;" />

<img src="static\屏幕截图 2021-12-22 142359.jpg" alt="屏幕截图 2021-12-22 142359" style="zoom:50%;" />

<img src="static\hysteresis.jpg" alt="hysteresis" style="zoom:50%;" />

#### canny边检测器

- 使用高斯函数的x,y导数过滤图像
- 找到梯度图像的导数幅值图和导数方向图
- 非最大化抑制：将数像素宽降为单像素宽
- 阈值化和连接（滞后阈值法）

#### 如何设计一个好的边检测器

- 好的检测：最小化错误检测和误检测的边
- 好的定位：检测边应与真实边距离尽可能地近
- 单值响应：最小化真实边附近局部极值的数量

### 角点检测

#### 基本思想

> 角点

- 平移窗口会导致patch表观的巨大差异
- 沿任意方向移动窗口在强度上都会有巨大变化

<img src="static\屏幕截图 2021-12-22 150600.jpg" alt="屏幕截图 2021-12-22 150600" style="zoom:50%;" />

#### 数学形式化描述

- SSD：将差异的平方进行累加

<img src="static\屏幕截图 2021-12-22 150857.jpg" alt="屏幕截图 2021-12-22 150857" style="zoom:50%;" />

- 我们希望E对任意的(u,v)都尽可能的大，说明可能存在角点

<img src="static\屏幕截图 2021-12-22 151340.jpg" alt="屏幕截图 2021-12-22 151340" style="zoom: 33%;" />

- E函数可以局部近似为二次误差函数
- 我们可以给与window表观信息，使之变为权重函数w(x,y)，如下图：

<img src="static\屏幕截图 2021-12-22 151646.jpg" alt="屏幕截图 2021-12-22 151646" style="zoom:50%;" />

<img src="static\屏幕截图 2021-12-22 151824.jpg" alt="屏幕截图 2021-12-22 151824" style="zoom:50%;" />

- 改写为矩阵形式，方便代码计算：

<img src="static\屏幕截图 2021-12-22 152145.jpg" alt="屏幕截图 2021-12-22 152145" style="zoom:50%;" />

- 对二次误差函数进行可视化：

<img src="static\屏幕截图 2021-12-22 152410.jpg" alt="屏幕截图 2021-12-22 152410" style="zoom:50%;" />

- 通过计算M二阶矩矩阵的特征值和特征向量，来定义移动方向上最大和最小误差的变化

<img src="static\屏幕截图 2021-12-22 153238.jpg" alt="屏幕截图 2021-12-22 153238" style="zoom:50%;" />

<img src="static\屏幕截图 2021-12-22 153151.jpg" alt="屏幕截图 2021-12-22 153151" style="zoom:50%;" />

- 对特征值的解释：

<img src="static\屏幕截图 2021-12-22 153452.jpg" alt="屏幕截图 2021-12-22 153452" style="zoom:50%;" />

- 如何高效地计算M？
  - 计算图像梯度$I_x,I_y$
  - 计算$I^2_x,I^2_y,I_xI_y$
  - 与窗口函数做卷积
  - 组建每个pixel的M矩阵

#### 总结

> 角点检测流程

- 计算图像梯度
- 计算M矩阵
- 计算特征值
- 阈值化（找有大响应的点$\lambda_{min}>threshold$）
- 在这些点中找到$\lambda_{min}$局部最大的点作为特征

#### Harris操作符（检测器）

- 数学定义
  - “Harris operator”  

<img src="static\屏幕截图 2021-12-22 161003.jpg" alt="屏幕截图 2021-12-22 161003" style="zoom:50%;" />

- 角点响应函数

<img src="static\屏幕截图 2021-12-22 162441.jpg" alt="屏幕截图 2021-12-22 162441" style="zoom:50%;" />

- Harris角点检测流程：

  - 计算图像梯度
  - 计算$I^2_x,I^2_y,I_xI_y$
  - apply窗口函数（往往是gaussian）
  - 计算响应函数：

  <img src="static\屏幕截图 2021-12-22 162906.jpg" alt="屏幕截图 2021-12-22 162906" style="zoom:50%;" />

  - 非最大化抑制



- 检测流程图如下图所示：

<img src="static\屏幕截图 2021-12-22 163258.jpg" alt="屏幕截图 2021-12-22 163258" style="zoom:50%;" />

